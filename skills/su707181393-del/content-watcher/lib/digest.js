class Digest {
  constructor(config = {}) {
    this.style = config.summaryStyle || 'bullet';
  }

  generate(articles) {
    const date = new Date().toLocaleDateString('zh-CN', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      weekday: 'long'
    });

    let md = `# ğŸ“° æ¯æ—¥èµ„è®¯æ‘˜è¦\n\n`;
    md += `**ç”Ÿæˆæ—¶é—´**: ${date}  \n`;
    md += `**æ–‡ç« æ•°é‡**: ${articles.length} ç¯‡  \n\n`;
    md += `---\n\n`;

    // Group by source
    const bySource = {};
    articles.forEach(a => {
      if (!bySource[a.source]) bySource[a.source] = [];
      bySource[a.source].push(a);
    });

    Object.entries(bySource).forEach(([source, items]) => {
      md += `## ğŸ“¡ ${source}\n\n`;
      
      items.forEach((article, idx) => {
        md += `### ${idx + 1}. ${article.title}\n\n`;
        md += `**é“¾æ¥**: [é˜…è¯»åŸæ–‡](${article.link})  \n`;
        md += `**ä½œè€…**: ${article.author}  \n`;
        md += `**æ—¶é—´**: ${this.formatDate(article.pubDate)}  \n\n`;
        
        if (article.summary) {
          md += `**æ‘˜è¦**:\n${article.summary}\n\n`;
        }
        
        md += `---\n\n`;
      });
    });

    md += `\n*Generated by Content Watcher*  \n`;
    md += `*Powered by OpenClaw* ğŸ¾`;

    return md;
  }

  formatDate(dateStr) {
    try {
      const d = new Date(dateStr);
      return d.toLocaleDateString('zh-CN');
    } catch {
      return dateStr;
    }
  }
}

module.exports = Digest;
